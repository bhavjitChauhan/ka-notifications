(()=>{"use strict";var e={626:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.getNotificationCount=n.getNotificationData=n.createOffscreenHeartbeat=void 0;const r=t(921);n.createOffscreenHeartbeat=async function(){await chrome.offscreen.hasDocument()||await chrome.offscreen.createDocument({url:chrome.runtime.getURL("heartbeat.html"),reasons:[chrome.offscreen.Reason.BLOBS],justification:"Keep service worker alive."})},n.getNotificationData=async function(e,n){const t=await(0,r.graphQLFetchJsonResponse)("getNotificationsForUser",e,void 0===n?void 0:{after:n});if(t?.cookieError)return{error:"cookie"};if(!t?.value)return{};const a=t.value?.data?.user?.notifications;return a?{value:{notifications:a.notifications,cursor:a.pageInfo.nextCursor}}:{error:"nonotifications"}},n.getNotificationCount=async function(e){const n=await(0,r.graphQLFetchJsonResponse)("getFullUserProfile",e);if(!n?.value)return{};const t=n.value?.data?.user;return t?{value:t.newNotificationCount}:{error:"!user",value:t}}},921:function(e,n,t){var r=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var a=Object.getOwnPropertyDescriptor(n,t);a&&!("get"in a?!n.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,a)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&r(n,e,t);return a(n,e),n};Object.defineProperty(n,"__esModule",{value:!0}),n.addFeedback=n.graphQLFetchJsonResponse=n.getUserFkeyCookie=n.graphQLFetch=void 0;const o=s(t(593)),i=t(448),c=o;async function d(e,n,t={}){try{const r=`https://www.khanacademy.org/api/internal/graphql/${e}?/fastly/`,a={method:"POST",headers:{"X-KA-fkey":n,"Content-Type":"application/json"},body:JSON.stringify({operationName:e,query:c[e],variables:t}),credentials:"same-origin"},s=await fetch(r,a);if(200===s.status)return s;if(400===s.status){const n=c[e].startsWith("mutation");console.warn(`The query for operation "${e}" is no longer in the safelist. Attempting to fetch the latest version from the safelist...`);const s=n?await(0,i.getLatestMutation)(e):await(0,i.getLatestQuery)(e);if(!s)throw new Error(`The query for operation "${e}" was not found in the safelist`);a.body=JSON.stringify({operationName:e,query:s,variables:t});const o=await fetch(r,a);if(200===o.status)return c[e]=s,o;throw new Error(`Error in GraphQL "${e}" call: Server responded with status ${o.status}.`)}throw new Error(`Error in GraphQL "${e}" call: Server responded with status ${s.status}.`)}catch(e){throw e}}async function l(){return new Promise(((e,n)=>{chrome.cookies.get({url:"https://www.khanacademy.org",name:"fkey"},(t=>{null===t?n("No fkey cookie found."):e(t.value)}))}))}n.graphQLFetch=d,n.getUserFkeyCookie=l,n.graphQLFetchJsonResponse=async function(e,n,t={}){let r;if(void 0!==n)r=n;else try{r=await l()}catch(e){return{cookieError:!0}}try{const n=await d(e,r,t);return{value:await n.json()}}catch(e){return e instanceof Error&&"Failed to fetch"===e.message?console.log("Possible network disconnect detected, please check your internet connection."):console.error("Error in response: ",e),{value:null}}},n.addFeedback=async function(e,n,t,r,a){try{const s=new URL("https://www.khanacademy.org/"+n).searchParams;let o,i,c="scratchpad";if("ResponseFeedbackNotification"===t)o="ANSWER"===r?"QUESTION":"COMMENT",i="REPLY",c=s.get("qa_expand_type");else{if("ProgramFeedbackNotification"!==t)return!1;o=r,i="QUESTION"===r?"ANSWER":"REPLY"}const l=n.split("?")[0].split("/").pop(),u=await d("feedbackQuery",e,{topicId:l,feedbackType:o,currentSort:5,qaExpandKey:s.get("qa_expand_key"),focusKind:c}),p=(await u.json()).data.feedback.feedback[0],y="QUESTION"===r&&"answer"===s.get("qa_expand_type")?p.answers[0].key:p.key;return(await d("AddFeedbackToDiscussion",e,{parentKey:y,textContent:a,feedbackType:i,fromVideoAuthor:!1,shownLowQualityNotice:!1})).ok}catch(e){return console.error("Error in sending feedback: ",e),!1}}},448:(e,n,t)=>{t.r(n),(()=>{var e,n,t=Object.create,r=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,o=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,c=(e,n)=>{for(var t in n)r(e,t,{get:n[t],enumerable:!0})},d=(e,n,t,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let c of s(n))i.call(e,c)||c===t||r(e,c,{get:()=>n[c],enumerable:!(o=a(n,c))||o.enumerable});return e},l=(e,n,t)=>{if(!n.has(e))throw TypeError("Cannot "+t)},u=(e,n,t)=>(l(e,n,"read from private field"),t?t.call(e):n.get(e)),p=(e,n,t)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,t)},y=(e,n,t,r)=>(l(e,n,"write to private field"),r?r.call(e,t):n.set(e,t),t),h=(e,n,t)=>(l(e,n,"access private method"),t),m=(e={".yarn/cache/cross-fetch-npm-4.0.0-9c67668db4-ecca4f37ff.zip/node_modules/cross-fetch/dist/browser-ponyfill.js"(e,n){var t,r="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global,a=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();t=a,function(e){var n=void 0!==t&&t||"undefined"!=typeof self&&self||void 0!==n&&n,r="URLSearchParams"in n,a="Symbol"in n&&"iterator"in Symbol,s="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in n,i="ArrayBuffer"in n;if(i)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(e){return e&&c.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var n={next:function(){var n=e.shift();return{done:void 0===n,value:n}}};return a&&(n[Symbol.iterator]=function(){return n}),n}function y(e){this.map={},e instanceof y?e.forEach((function(e,n){this.append(n,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(n){this.append(n,e[n])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise((function(n,t){e.onload=function(){n(e.result)},e.onerror=function(){t(e.error)}}))}function f(e){var n=new FileReader,t=m(n);return n.readAsArrayBuffer(e),t}function g(e){if(e.slice)return e.slice(0);var n=new Uint8Array(e.byteLength);return n.set(new Uint8Array(e)),n.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){var n;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i&&s&&(n=e)&&DataView.prototype.isPrototypeOf(n)?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(e)||d(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(f)}),this.text=function(){var e,n,t,r=h(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=m(n=new FileReader),n.readAsText(e),t;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var n=new Uint8Array(e),t=new Array(n.length),r=0;r<n.length;r++)t[r]=String.fromCharCode(n[r]);return t.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}y.prototype.append=function(e,n){e=l(e),n=u(n);var t=this.map[e];this.map[e]=t?t+", "+n:n},y.prototype.delete=function(e){delete this.map[l(e)]},y.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},y.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},y.prototype.set=function(e,n){this.map[l(e)]=u(n)},y.prototype.forEach=function(e,n){for(var t in this.map)this.map.hasOwnProperty(t)&&e.call(n,this.map[t],t,this)},y.prototype.keys=function(){var e=[];return this.forEach((function(n,t){e.push(t)})),p(e)},y.prototype.values=function(){var e=[];return this.forEach((function(n){e.push(n)})),p(e)},y.prototype.entries=function(){var e=[];return this.forEach((function(n,t){e.push([t,n])})),p(e)},a&&(y.prototype[Symbol.iterator]=y.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function k(e,n){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var t,r,a=(n=n||{}).body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,n.headers||(this.headers=new y(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,a||null==e._bodyInit||(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=n.credentials||this.credentials||"same-origin",!n.headers&&this.headers||(this.headers=new y(n.headers)),this.method=(r=(t=n.method||this.method||"GET").toUpperCase(),w.indexOf(r)>-1?r:t),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==n.cache&&"no-cache"!==n.cache)){var s=/([?&])_=[^&]*/;s.test(this.url)?this.url=this.url.replace(s,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function b(e){var n=new FormData;return e.trim().split("&").forEach((function(e){if(e){var t=e.split("="),r=t.shift().replace(/\+/g," "),a=t.join("=").replace(/\+/g," ");n.append(decodeURIComponent(r),decodeURIComponent(a))}})),n}function T(e,n){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');n||(n={}),this.type="default",this.status=void 0===n.status?200:n.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===n.statusText?"":""+n.statusText,this.headers=new y(n.headers),this.url=n.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},_.call(k.prototype),_.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},T.error=function(){var e=new T(null,{status:0,statusText:""});return e.type="error",e};var v=[301,302,303,307,308];T.redirect=function(e,n){if(-1===v.indexOf(n))throw new RangeError("Invalid status code");return new T(null,{status:n,headers:{location:e}})},e.DOMException=n.DOMException;try{new e.DOMException}catch(n){e.DOMException=function(e,n){this.message=e,this.name=n;var t=Error(e);this.stack=t.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function E(t,r){return new Promise((function(a,o){var c=new k(t,r);if(c.signal&&c.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var d=new XMLHttpRequest;function l(){d.abort()}d.onload=function(){var e,n,t={status:d.status,statusText:d.statusText,headers:(e=d.getAllResponseHeaders()||"",n=new y,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var t=e.split(":"),r=t.shift().trim();if(r){var a=t.join(":").trim();n.append(r,a)}})),n)};t.url="responseURL"in d?d.responseURL:t.headers.get("X-Request-URL");var r="response"in d?d.response:d.responseText;setTimeout((function(){a(new T(r,t))}),0)},d.onerror=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},d.ontimeout=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},d.onabort=function(){setTimeout((function(){o(new e.DOMException("Aborted","AbortError"))}),0)},d.open(c.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(n){return e}}(c.url),!0),"include"===c.credentials?d.withCredentials=!0:"omit"===c.credentials&&(d.withCredentials=!1),"responseType"in d&&(s?d.responseType="blob":i&&c.headers.get("Content-Type")&&-1!==c.headers.get("Content-Type").indexOf("application/octet-stream")&&(d.responseType="arraybuffer")),!r||"object"!=typeof r.headers||r.headers instanceof y?c.headers.forEach((function(e,n){d.setRequestHeader(n,e)})):Object.getOwnPropertyNames(r.headers).forEach((function(e){d.setRequestHeader(e,u(r.headers[e]))})),c.signal&&(c.signal.addEventListener("abort",l),d.onreadystatechange=function(){4===d.readyState&&c.signal.removeEventListener("abort",l)}),d.send(void 0===c._bodyInit?null:c._bodyInit)}))}E.polyfill=!0,n.fetch||(n.fetch=E,n.Headers=y,n.Request=k,n.Response=T),e.Headers=y,e.Request=k,e.Response=T,e.fetch=E}({}),a.fetch.ponyfill=!0,delete a.fetch.polyfill;var s=r.fetch?r:a;(e=s.fetch).default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e}},function(){return n||(0,e[s(e)[0]])((n={exports:{}}).exports,n),n.exports}),f={};c(f,{Answer:()=>On,BaseMessage:()=>In,Client:()=>zn,EmailRegex:()=>Ce,EmailRegexMatch:()=>Ie,FeedbackFocusKind:()=>Je,FeedbackKeyRegex:()=>me,FeedbackKeyRegexMatch:()=>fe,FeedbackSort:()=>Ze,FeedbackType:()=>Ye,FeedbackTypename:()=>ze,GoogleIDRegex:()=>Te,GoogleIDRegexMatch:()=>ve,KaidRegex:()=>q,KaidRegexMatch:()=>F,ListProgramSortOrder:()=>Xe,MESSAGE_ENCRYPTED_KEY_LENGTHS:()=>_e,MESSAGE_KEY_LENGTHS:()=>he,Message:()=>Un,MessageEncryptedKeyRegex:()=>we,MessageEncryptedKeyRegexMatch:()=>ke,MessageType:()=>Rn,PROGRAM_ID_LENGTHS:()=>G,PROGRAM_KEY_LENGTHS:()=>te,PROGRAM_URL_PATHS:()=>Y,Program:()=>fn,ProgramEditorType:()=>We,ProgramIDRegex:()=>H,ProgramIDRegexMatch:()=>W,ProgramImagePathRegex:()=>ee,ProgramImagePathRegexMatch:()=>ne,ProgramKeyRegex:()=>re,ProgramKeyRegexMatch:()=>ae,ProgramType:()=>hn,ProgramURLRegex:()=>z,ProgramURLRegexMatch:()=>Z,QualarooIDRegex:()=>Ae,QualarooIDRegexMatch:()=>Se,Question:()=>Dn,Reply:()=>$n,ServiceErrorCode:()=>je,ServiceErrorName:()=>Ge,TipsAndThanks:()=>Ln,TypeToMessageClass:()=>Jn,URL_LOCALES:()=>M,URL_TLDS:()=>K,User:()=>en,UserAccessLevel:()=>He,UserURLRegex:()=>V,UserURLRegexMatch:()=>Q,assertDataResponse:()=>an,avatarNameToSlug:()=>wn,avatarNames:()=>gn,avatarSlugToName:()=>kn,avatarSlugs:()=>_n,convertAvatarPNGToSVG:()=>An,convertAvatarSVGToPNG:()=>En,extractAvatarSlug:()=>vn,generateAvatarPNG:()=>Tn,generateAvatarSVG:()=>bn,getLatestFragment:()=>C,getLatestMutation:()=>P,getLatestQuery:()=>S,isAnswerSchema:()=>qn,isDataResponse:()=>nn,isEmail:()=>Re,isEncryptedFeedbackKey:()=>be,isFeedbackKey:()=>ge,isGoogleID:()=>Ee,isInputErrorResponse:()=>rn,isKaid:()=>B,isProgramID:()=>J,isProgramKey:()=>se,isProgramURL:()=>X,isQualarooID:()=>Pe,isQuestionSchema:()=>Mn,isReplySchema:()=>Kn,isServiceErrorsResponse:()=>tn,isTipsAndThanksSchema:()=>xn,isUserURL:()=>j,mutations:()=>qe,programIDtoKey:()=>on,programKeyToID:()=>sn,queries:()=>g,resolveFeedbackKey:()=>un,resolveKaid:()=>cn,resolveProgramID:()=>ln,resolveUsername:()=>dn});var g={};c(g,{AvatarDataForProfile:()=>_,FeedbackQuery:()=>w,GetFeedbackReplies:()=>k,GetFeedbackRepliesPage:()=>b,GetFullUserProfile:()=>oe,GetProfileWidgets:()=>ie,GetUserByUsernameOrEmail:()=>ce,GetUserHoverCardProfile:()=>de,Hotlist:()=>le,ProgramQuery:()=>ue,ProjectsAuthoredByUser:()=>pe,QAExpandKeyInfo:()=>Ke,QaExpandKeyInfo:()=>ye,avatarDataForProfile:()=>U,feedbackQuery:()=>O,getFeedbackReplies:()=>D,getFeedbackRepliesPage:()=>$,getFullUserProfile:()=>Ne,getProfileWidgets:()=>Ue,getUserByUsernameOrEmail:()=>Oe,getUserHoverCardProfile:()=>De,hotlist:()=>$e,programQuery:()=>Le,projectsAuthoredByUser:()=>xe});var _,w,k,b,T="https://www.khanacademy.org/api/internal/graphql",v="https://cdn.jsdelivr.net/gh/bhavjitChauhan/khan-api@safelist",E=`bhavjitchauhan/khan-api_${Date.now()}`,A=((e,n,a)=>(a=null!=e?t(o(e)):{},d(r(a,"default",{value:e,enumerable:!0}),e)))(m());async function S(e){const n=await I(`${v}/query/${e}`);return 404===n.status?null:await n.text()}async function P(e){const n=await I(`${v}/mutation/${e}`);return 404===n.status?null:await n.text()}async function C(e){const n=await I(`${v}/fragment/${e}`);return 404===n.status?null:await n.text()}async function I(e,n){return await(0,A.default)(e,n)}async function R(e,n,t){return t={method:"post",body:JSON.stringify(n),...t},await I(e,t)}async function N(e,n,t={},r){const a={query:n,variables:t},s=await R(e,a,r);if(403===s.status&&(await s.text()).startsWith("routes._validatePermission: [unauthorized error] Operation not found in safelist")){const t=n.startsWith("query"),s=n.match(/^(?:query|mutation) (\w+)/)?.[1];if(!s)throw new Error("An unknown query is no longer in the safelist");console.warn(`The query for operation "${s}" is no longer in the safelist. Attempting to fetch the latest version from the safelist...`);const o=t?await S(s):await P(s);if(!o)throw new Error(`The query for operation "${s}" was not found in the safelist`);return await R(e,{...a,query:o},r)}return s}function U(e,n){return N(`${T}/avatarDataForProfile`,_.query,"string"==typeof e?{kaid:e}:e,n)}function O(e,n){return N(`${T}/feedbackQuery`,w.query,e,n)}function D(e,n){return N(`${T}/getFeedbackReplies`,k.query,"string"==typeof e?{postKey:e}:e,n)}function $(e,n){return N(`${T}/getFeedbackRepliesPage`,b.query,e,n)}function L(e){return e.replace(/-/g,"+").replace(/_/g,"/")}function x(e){return new RegExp(`(${e.source.slice(1,-1)})`)}(_||(_={})).query="query avatarDataForProfile($kaid: String!) {\n  user(kaid: $kaid) {\n    id\n    avatar {\n      name\n      imageSrc\n      __typename\n    }\n    __typename\n  }\n}\n",(w||(w={})).query="query feedbackQuery($topicId: String!, $focusKind: String!, $cursor: String, $limit: Int, $feedbackType: FeedbackType!, $currentSort: Int, $qaExpandKey: String) {\n  feedback(focusId: $topicId, cursor: $cursor, limit: $limit, feedbackType: $feedbackType, focusKind: $focusKind, sort: $currentSort, qaExpandKey: $qaExpandKey, answersLimit: 1) {\n    feedback {\n      isLocked\n      isPinned\n      replyCount\n      appearsAsDeleted\n      author {\n        id\n        kaid\n        nickname\n        avatar {\n          name\n          imageSrc\n          __typename\n        }\n        __typename\n      }\n      badges {\n        name\n        icons {\n          smallUrl\n          __typename\n        }\n        description\n        __typename\n      }\n      content\n      date\n      definitelyNotSpam\n      deleted\n      downVoted\n      expandKey\n      feedbackType\n      flaggedBy\n      flaggedByUser\n      flags\n      focusUrl\n      focus {\n        kind\n        id\n        translatedTitle\n        relativeUrl\n        __typename\n      }\n      fromVideoAuthor\n      key\n      lowQualityScore\n      notifyOnAnswer\n      permalink\n      qualityKind\n      replyCount\n      replyExpandKeys\n      showLowQualityNotice\n      sumVotesIncremented\n      upVoted\n      ... on QuestionFeedback {\n        hasAnswered\n        answers {\n          isLocked\n          isPinned\n          replyCount\n          appearsAsDeleted\n          author {\n            id\n            kaid\n            nickname\n            avatar {\n              name\n              imageSrc\n              __typename\n            }\n            __typename\n          }\n          badges {\n            name\n            icons {\n              smallUrl\n              __typename\n            }\n            description\n            __typename\n          }\n          content\n          date\n          definitelyNotSpam\n          deleted\n          downVoted\n          expandKey\n          feedbackType\n          flaggedBy\n          flaggedByUser\n          flags\n          focusUrl\n          focus {\n            kind\n            id\n            translatedTitle\n            relativeUrl\n            __typename\n          }\n          fromVideoAuthor\n          key\n          lowQualityScore\n          notifyOnAnswer\n          permalink\n          qualityKind\n          replyCount\n          replyExpandKeys\n          showLowQualityNotice\n          sumVotesIncremented\n          upVoted\n          __typename\n        }\n        isOld\n        answerCount\n        __typename\n      }\n      ... on AnswerFeedback {\n        question {\n          isLocked\n          isPinned\n          replyCount\n          appearsAsDeleted\n          author {\n            id\n            kaid\n            nickname\n            avatar {\n              name\n              imageSrc\n              __typename\n            }\n            __typename\n          }\n          badges {\n            name\n            icons {\n              smallUrl\n              __typename\n            }\n            description\n            __typename\n          }\n          content\n          date\n          definitelyNotSpam\n          deleted\n          downVoted\n          expandKey\n          feedbackType\n          flaggedBy\n          flaggedByUser\n          flags\n          focusUrl\n          focus {\n            kind\n            id\n            translatedTitle\n            relativeUrl\n            __typename\n          }\n          fromVideoAuthor\n          key\n          lowQualityScore\n          notifyOnAnswer\n          permalink\n          qualityKind\n          replyCount\n          replyExpandKeys\n          showLowQualityNotice\n          sumVotesIncremented\n          upVoted\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    cursor\n    isComplete\n    sortedByDate\n    __typename\n  }\n}\n",(k||(k={})).query="query getFeedbackReplies($postKey: String!) {\n  feedbackReplies(feedbackKey: $postKey) {\n    isLocked\n    isPinned\n    expandKey\n    appearsAsDeleted\n    author {\n      id\n      kaid\n      nickname\n      avatar {\n        name\n        imageSrc\n        __typename\n      }\n      __typename\n    }\n    content\n    date\n    definitelyNotSpam\n    deleted\n    downVoted\n    expandKey\n    feedbackType\n    flaggedBy\n    flaggedByUser\n    flags\n    focusUrl\n    fromVideoAuthor\n    key\n    lowQualityScore\n    notifyOnAnswer\n    permalink\n    qualityKind\n    replyCount\n    replyExpandKeys\n    showLowQualityNotice\n    sumVotesIncremented\n    upVoted\n    __typename\n  }\n}\n",(b||(b={})).query="query getFeedbackRepliesPage($postKey: String!, $cursor: String, $limit: Int!) {\n  feedbackRepliesPaginated(feedbackKey: $postKey, cursor: $cursor, limit: $limit) {\n    cursor\n    isComplete\n    feedback {\n      isLocked\n      isPinned\n      expandKey\n      appearsAsDeleted\n      author {\n        id\n        kaid\n        nickname\n        avatar {\n          name\n          imageSrc\n          __typename\n        }\n        __typename\n      }\n      content\n      date\n      definitelyNotSpam\n      deleted\n      downVoted\n      expandKey\n      feedbackType\n      flaggedBy\n      flaggedByUser\n      flags\n      focusUrl\n      fromVideoAuthor\n      key\n      lowQualityScore\n      notifyOnAnswer\n      permalink\n      qualityKind\n      replyCount\n      replyExpandKeys\n      showLowQualityNotice\n      sumVotesIncremented\n      upVoted\n      __typename\n    }\n    __typename\n  }\n}\n";var K=["com","org"],M=["as","az","cs","da","el","gu","hu","id","it","lt","ja","kk","kn","ky","lv","mn","mr","my","nl","pt-pt","ru","sv","ta","uz","bg","bn","de","en","es","fr","hi","hy","ka","km","ko","nb","pa","pl","pt","ro","sr","tr","vi","zh-hans","sgn-us"],q=/^kaid_\d{20,25}$/,F=x(q),B=e=>q.test(e),V=new RegExp(`^https?:\\/\\/(?:(?:www|${M.join("|")})\\.)?khanacademy\\.(?:${K.join("|")})\\/profile\\/((?!kaid_|kaid_\\D)\\w+|(?:${q.toString().slice(2,-2)}))(?:\\/.*)?$`,"i"),Q=x(V),j=e=>V.test(e),G=[9,10,16],H=new RegExp(`^[1-9](?:(?:${G.map((e=>`\\d{${e-1}}`)).join("|")}))$`),W=new RegExp(`(?:^|\\D)(${H.source.slice(1,-1)})(?:$|\\D)`);function J(e){return H.test(e.toString())}var Y=["computer-programming","cs","pixar","nasa","piab-sandbox","computer-science","hour-of-code","math","differential-equations","electrical-engineering","mcat","apchem-topic","chemistry","art-history-basics","biology"],z=new RegExp(`^https?:\\/\\/(?:(?:www|${M.join("|")})\\.)?khanacademy\\.(?:${K.join("|")})\\/(?:${Y.join("|")})\\/[\\w\\d-.~()'!*:@,;]+\\/(${H.toString().slice(2,-2)})$`,"i"),Z=x(z);function X(e){return z.test(e)}var ee=new RegExp(`^\\/(?:${Y.join("|")})\\/[\\w\\d-.~()'!*:@,;]+\\/\\d+\\/(\\d+)\\.png$`),ne=x(ee),te=[51,54],re=/^ag5zfmtoYW4tYWNhZGVteXI(?:U|X)CxIKU2NyYXRjaHBhZB(?:i|j)(?=[\w-]*$)(?:.{7}w|.{9}C(?:g|w|A|Q)w)$/,ae=x(re);function se(e){if(te.includes(e.length))return!1;if(!re.test(e))return!1;try{return atob(L(e)),!0}catch{return!1}}var oe,ie,ce,de,le,ue,pe,ye,he=[106,107,108,110,111],me=/^ag5zfmtoYW4tYWNhZGVteX(?:I|J)(?:A|B|7|9|-|_)CxIIVXNlckRhdGEi(?:Gm|GG|G2|Hm|HG|HW)thaWRf(?:M|N|O)(?:\w{34}|\w{29,31}|\w{27})(?:LEghGZWVkYmFjaxiAg[I-P](?:O|P|W|X|2|3)|DAsSCEZlZWRiYWNrGICA|MCxIIRmVlZGJhY2sYgI(?:C|D)|wLEghGZWVkYmFjaxiAg|DAsSCEZlZWRiYWNrGICA)(?:[\w-]{5}|[\w-]{7,8})(?:M|DA|C(?:g|w|A|Q)w)$/,fe=x(me),ge=e=>me.test(e),_e=[301],we=/^kaencrypted_[a-z0-9]{32}_[a-z0-9]{256}$/,ke=x(we),be=e=>we.test(e),Te=/^http:\/\/googleid\.khanacademy\.org\/(\d+)$/,ve=x(Te),Ee=e=>Te.test(e),Ae=/^_gae_bingo_random:(\w+-\w+-\w+)$/,Se=x(Ae),Pe=e=>Ae.test(e),Ce=/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,Ie=x(Ce),Re=e=>Ce.test(e);function Ne(e,n){return N(`${T}/getFullUserProfile`,oe.query,"string"==typeof e?B(e)?{kaid:e}:{username:e}:e,n)}function Ue(e,n){return N(`${T}/getProfileWidgets`,ie.query,"string"==typeof e&&B(e)?{kaid:e}:e,n)}function Oe(e,n){return N(`${T}/getUserByUsernameOrEmail`,ce.query,"string"==typeof e?Re(e)?{email:e}:{username:e}:e,n)}function De(e,n){return N(`${T}/getUserHoverCardProfile`,de.query,"string"==typeof e?{kaid:e}:e,n)}function $e(e,n){return N(`${T}/hotlist`,le.query,e,n)}function Le(e,n){return N(`${T}/programQuery`,ue.query,"number"==typeof e?{programId:e.toString()}:"string"==typeof e?{programId:e}:e,n)}function xe(e,n){return N(`${T}/projectsAuthoredByUser`,pe.query,e,n)}function Ke(e,n){return N(`${T}/QAExpandKeyInfo`,ye.query,"string"==typeof e?{encryptedKey:e}:e,n)}(oe||(oe={})).query='query getFullUserProfile($kaid: String, $username: String) {\n  user(kaid: $kaid, username: $username) {\n    id\n    kaid\n    key\n    userId\n    email\n    username\n    profileRoot\n    gaUserId\n    isPhantom\n    isDeveloper: hasPermission(name: "can_do_what_only_admins_can_do")\n    isCurator: hasPermission(name: "can_curate_tags", scope: ANY_ON_CURRENT_LOCALE)\n    isCreator: hasPermission(name: "has_creator_role", scope: ANY_ON_CURRENT_LOCALE)\n    isPublisher: hasPermission(name: "can_publish", scope: ANY_ON_CURRENT_LOCALE)\n    isModerator: hasPermission(name: "can_moderate_users", scope: GLOBAL)\n    isParent\n    isTeacher\n    isFormalTeacher\n    isDataCollectible\n    isChild\n    isOrphan\n    isCoachingLoggedInUser\n    canModifyCoaches\n    nickname\n    hideVisual\n    joined\n    points\n    countVideosCompleted\n    bio\n    profile {\n      accessLevel\n      __typename\n    }\n    soundOn\n    muteVideos\n    showCaptions\n    prefersReducedMotion\n    noColorInVideos\n    newNotificationCount\n    canHellban: hasPermission(name: "can_ban_users", scope: GLOBAL)\n    canMessageUsers: hasPermission(name: "can_send_moderator_messages", scope: GLOBAL)\n    isSelf: isActor\n    hasStudents: hasCoachees\n    hasClasses\n    hasChildren\n    hasCoach\n    badgeCounts\n    homepageUrl\n    isMidsignupPhantom\n    includesDistrictOwnedData\n    includesKmapDistrictOwnedData\n    includesK4dDistrictOwnedData\n    canAccessDistrictsHomepage\n    preferredKaLocale {\n      id\n      kaLocale\n      status\n      __typename\n    }\n    underAgeGate {\n      parentEmail\n      daysUntilCutoff\n      approvalGivenAt\n      __typename\n    }\n    authEmails\n    signupDataIfUnverified {\n      email\n      emailBounced\n      __typename\n    }\n    pendingEmailVerifications {\n      email\n      __typename\n    }\n    hasAccessToAIGuideTeacher\n    tosAccepted\n    shouldShowAgeCheck\n    birthMonthYear\n    lastLoginCountry\n    __typename\n  }\n  actorIsImpersonatingUser\n  isAIGuideEnabled\n  hasAccessToAIGuideDev\n}\n',(ie||(ie={})).query="query getProfileWidgets($kaid: String!) {\n  user(kaid: $kaid) {\n    id\n    kaid\n    badgeCounts\n    isChild\n    profile {\n      programs {\n        id\n        authorKaid\n        authorNickname\n        deleted\n        displayableSpinoffCount\n        imagePath\n        key\n        sumVotesIncremented\n        translatedTitle: title\n        url\n        __typename\n      }\n      __typename\n    }\n    programs(sort: TOP, pageInfo: {itemsPerPage: 2}) {\n      programs {\n        id\n        authorKaid\n        authorNickname\n        deleted\n        displayableSpinoffCount\n        imagePath\n        key\n        sumVotesIncremented\n        translatedTitle: title\n        url\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  userSummary(kaid: $kaid) {\n    statistics {\n      answers\n      comments\n      flags\n      projectanswers\n      projectquestions\n      questions\n      replies\n      votes\n      __typename\n    }\n    __typename\n  }\n}\n",(ce||(ce={})).query="query getUserByUsernameOrEmail($username: String, $email: String) {\n  user(username: $username, email: $email) {\n    id\n    kaid\n    __typename\n  }\n}\n",(de||(de={})).query="query getUserHoverCardProfile($kaid: String!) {\n  user(kaid: $kaid) {\n    id\n    nickname\n    username\n    bio\n    avatar {\n      name\n      imageSrc\n      __typename\n    }\n    points\n    isPhantom\n    isActor\n    isCoachedByActor\n    userSummaryIsVisibleToActor\n    actorHasUserScopedPermission(capability: CAN_VIEW_USER_IDENTITY)\n    __typename\n  }\n}\n",(le||(le={})).query="query hotlist($curationNodeId: String, $onlyOfficialProjectSpinoffs: Boolean!, $sort: ListProgramSortOrder, $pageInfo: ListProgramsPageInfo) {\n  listTopPrograms(curationNodeId: $curationNodeId, onlyOfficialProjectSpinoffs: $onlyOfficialProjectSpinoffs, sort: $sort, pageInfo: $pageInfo) {\n    complete\n    cursor\n    programs {\n      id\n      key\n      authorKaid\n      authorNickname\n      displayableSpinoffCount\n      imagePath\n      sumVotesIncremented\n      translatedTitle: title\n      url\n      __typename\n    }\n    __typename\n  }\n}\n",(ue||(ue={})).query="query programQuery($programId: String!) {\n  programById(id: $programId) {\n    byChild\n    category\n    created\n    creatorProfile: author {\n      id\n      nickname\n      profileRoot\n      profile {\n        accessLevel\n        __typename\n      }\n      __typename\n    }\n    deleted\n    description\n    spinoffCount: displayableSpinoffCount\n    docsUrlPath\n    flags\n    flaggedBy: flaggedByKaids\n    flaggedByUser: isFlaggedByCurrentUser\n    height\n    hideFromHotlist\n    id\n    imagePath\n    isProjectOrFork: originIsProject\n    isOwner\n    kaid: authorKaid\n    key\n    newUrlPath\n    originScratchpad: originProgram {\n      deleted\n      translatedTitle\n      url\n      __typename\n    }\n    restrictPosting\n    revision: latestRevision {\n      id\n      code\n      configVersion\n      created\n      editorType\n      folds\n      __typename\n    }\n    slug\n    sumVotesIncremented\n    title\n    topic: parentCurationNode {\n      id\n      nodeSlug: slug\n      relativeUrl\n      slug\n      translatedTitle\n      __typename\n    }\n    translatedTitle\n    url\n    userAuthoredContentType\n    upVoted\n    width\n    __typename\n  }\n}\n",(pe||(pe={})).query="query projectsAuthoredByUser($kaid: String, $pageInfo: ListProgramsPageInfo, $sort: ListProgramSortOrder) {\n  user(kaid: $kaid) {\n    id\n    programs(pageInfo: $pageInfo, sort: $sort) {\n      complete\n      cursor\n      programs {\n        id\n        key\n        authorKaid\n        authorNickname\n        displayableSpinoffCount\n        imagePath\n        sumVotesIncremented\n        translatedTitle: title\n        url\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n",(ye||(ye={})).query="query QAExpandKeyInfo($encryptedKey: String) {\n  qaExpandKeyInfo(encryptedQaExpandKey: $encryptedKey) {\n    feedbackType\n    unencryptedKey\n    __typename\n  }\n}\n";var Me,qe={};function Fe(e,n){return N(`${T}/loginWithPasswordMutation`,Me.query,e,{headers:{"x-ka-fkey":E,Cookie:`fkey=${E}`},...n})}c(qe,{LoginWithPasswordMutation:()=>Me,loginWithPasswordMutation:()=>Fe}),(e=>{let n;var t;e.query="mutation loginWithPasswordMutation($identifier: String!, $password: String!) {\n  loginWithPassword(identifier: $identifier, password: $password) {\n    user {\n      id\n      kaid\n      canAccessDistrictsHomepage\n      isTeacher\n      hasUnresolvedInvitations\n      transferAuthToken\n      preferredKaLocale {\n        id\n        kaLocale\n        status\n        __typename\n      }\n      __typename\n    }\n    isFirstLogin\n    error {\n      code\n      __typename\n    }\n    __typename\n  }\n}\n",(t=n=e.ErrorCode||(e.ErrorCode={})).INVALID_CREDENTIALS="INVALID_CREDENTIALS",t.TOO_MANY_ATTEMPTS="TOO_MANY_ATTEMPTS"})(Me||(Me={}));var Be,Ve,Qe=class{constructor(e,n){return e instanceof zn?this.client=e:n??(n=e),n&&this.copy(n),this}copy(e){return Object.assign(this,e),this}copyFromSchema(e){return this.rawData={...this.rawData,...e},this.copy(this.transformSchema(e))}isSchema(e){return this.is(this.transformSchema(e))}},je=(e=>(e.DOWNSTREAM_SERVICE_ERROR="DOWNSTREAM_SERVICE_ERROR",e))(je||{}),Ge=(e=>(e.users="users",e))(Ge||{}),He=(e=>(e.COACH="COACH",e.PUBLIC="PUBLIC",e))(He||{}),We=(e=>(e.pjs="pjs",e.webpage="webpage",e.ace_sql="ace_sql",e.unknown="",e))(We||{}),Je=(e=>(e.Challenge="Challenge",e.Interactive="Interactive",e.Project="Project",e.Scratchpad="Scratchpad",e.Talkthrough="Talkthrough",e))(Je||{}),Ye=(e=>(e.ALL_PROJECT_ANSWER="ALL_PROJECT_ANSWER",e.ALL_PROJECT_QUESTION="ALL_PROJECT_QUESTION",e.ANSWER="ANSWER",e.COMMENT="COMMENT",e.PROGRAM="PROGRAM",e.PROJECTFEEDBACK="PROJECTFEEDBACK",e.PROJECT_CRITIQUE_ANSWER="PROJECT_CRITIQUE_ANSWER",e.PROJECT_CRITIQUE_QUESTION="PROJECT_CRITIQUE_QUESTION",e.PROJECT_EVAL_ANSWER="PROJECT_EVAL_ANSWER",e.PROJECT_EVAL_QUESTION="PROJECT_EVAL_QUESTION",e.PROJECT_HELP_ANSWER="PROJECT_HELP_ANSWER",e.PROJECT_HELP_QUESTION="PROJECT_HELP_QUESTION",e.QUESTION="QUESTION",e.REPLY="REPLY",e.SUGGESTED_CLARIFICATION="SUGGESTED_CLARIFICATION",e))(Ye||{}),ze=(e=>(e.AnswerFeedback="AnswerFeedback",e.BasicFeedback="BasicFeedback",e.LowQualityFeedback="LowQualityFeedback",e.QuestionFeedback="QuestionFeedback",e))(ze||{}),Ze=(e=>(e[e.TopVoted=1]="TopVoted",e[e.Recent=2]="Recent",e[e.Trending=5]="Trending",e))(Ze||{}),Xe=(e=>(e.TOP="TOP",e.RECENT="RECENT",e.HOT="HOT",e.OFFICIAL="OFFICIAL",e.UPVOTE="UPVOTE",e.OLDEST="OLDEST",e))(Xe||{});Be=new WeakSet,Ve=function(){if(this.kaid)return this.kaid;if(this.username)return this.username;if(this.email)return this.email;throw new Error("User has no identifier")};var en=class e extends Qe{constructor(){super(...arguments),p(this,Be)}get url(){return this.kaid?`https://www.khanacademy.org/profile/${this.username??this.kaid}`:null}static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({kaid:B(n)?n:void 0,username:B(n)||Re(n)?void 0:n,email:Re(n)?n:void 0})}transformSchema(e){return{emails:e.authEmails??void 0,badgeCounts:e.badgeCounts?JSON.parse(e.badgeCounts):void 0,bio:e.bio??void 0,canAccessDistrictsHomepage:e.canAccessDistrictsHomepage??void 0,canHellban:e.canHellban??void 0,canMessageUsers:e.canMessageUsers??void 0,canModifyCoaches:e.canModifyCoaches??void 0,completedVideos:e.countVideosCompleted,email:e.email??void 0,hasAccessToAIGuideDev:e.hasAccessToAIGuideDev??void 0,hasAccessToAIGuideTeacher:e.hasAccessToAIGuideTeacher??void 0,hasChildren:e.hasChildren??void 0,hasClasses:e.hasClasses??void 0,hasCoach:e.hasCoach??void 0,hasStudents:e.hasStudents??void 0,child:e.isChild??void 0,creator:e.isCreator??void 0,curator:e.isCurator??void 0,developer:e.isDeveloper??void 0,midsignupPhantom:e.isMidsignupPhantom??void 0,moderator:e.isModerator??void 0,orphan:e.isOrphan??void 0,parent:e.isParent??void 0,phantom:e.isPhantom??void 0,publisher:e.isPublisher??void 0,self:e.isSelf??void 0,teacher:e.isTeacher??void 0,formalTeacher:e.isFormalTeacher??void 0,joined:e.joined?new Date(e.joined):void 0,kaid:"string"==typeof e.kaid&&B(e.kaid)?e.kaid:"string"==typeof e.kaid?null:void 0,key:e.key??void 0,newNotifications:e.newNotificationCount??void 0,nickname:e.nickname??void 0,points:e.points??void 0,accessLevel:e.profile?.accessLevel,googleID:"string"==typeof e.userId&&Ee(e.userId)?e.userId.match(Te)[1]:"string"==typeof e.userId?null:void 0,qualarooID:"string"==typeof e.qualarooId&&Pe(e.qualarooId)?e.qualarooId.match(Ae)[1]:"string"==typeof e.qualarooId?null:void 0,username:e.username??(e.profileRoot?B(e.profileRoot.slice(9,-1))?null:e.profileRoot.slice(9,-1):e.username)}}async get(e=this.client??new zn){const n=await e.getUser(h(this,Be,Ve).call(this));return this.copy(n)}async getAvatar(e=this.client??new zn){const n=await e.getUserAvatar(h(this,Be,Ve).call(this));return this.copy({avatar:n}),n}async getStatistics(e=this.client??new zn){const n=await e.getUserStatistics(h(this,Be,Ve).call(this));return this.copy({statistics:n})}async*getPrograms(e=this.client??new zn,n,t){for await(const r of e.getUserPrograms(h(this,Be,Ve).call(this),n,t))this.programs||this.copy({programs:[]}),this.programs?.push(...r),yield r;return this}async getAllPrograms(e=this.client??new zn,n,t){const r=await e.getAllUserPrograms(h(this,Be,Ve).call(this),n,t);return this.copy({programs:r})}is(e){return this.kaid&&e.kaid||this.email&&e.email||this.key&&e.key||this.username&&e.username||this.googleID&&e.googleID||this.qualarooID&&e.qualarooID?this.kaid&&e.kaid&&this.kaid===e.kaid||this.email&&e.email&&this.email===e.email||this.key&&e.key&&this.key===e.key||this.username&&e.username&&this.username===e.username||this.googleID&&e.googleID&&this.googleID===e.googleID||this.qualarooID&&e.qualarooID&&this.qualarooID===e.qualarooID||!1:(console.warn("Users don't have any identifiers that can be compared"),!1)}};function nn(e){return"data"in e&&!("errors"in e)}function tn(e){return"errors"in e&&Array.isArray(e.errors)&&"data"in e}function rn(e){return"errors"in e&&Array.isArray(e.errors)&&!("data"in e)}function an(e){if(tn(e))throw new Error("Expected data response but got service errors response: "+e.errors.map((e=>e.message)).join(", "));if(rn(e))throw new Error("Expected data response but got input errors response: "+e.errors.map((e=>e.message)).join(", "));if(!nn(e))throw new Error("Expected data response but got unknown response")}function sn(e){if(!se(e))throw new Error("Invalid program key");let n=atob(L(e)).split("").map((e=>e.charCodeAt(0)));const t=n[17];if(20===t)n=n.slice(32,37);else{if(23!==t)throw new Error(`Unknown program key version: ${t}`);n=n.slice(34,40)}let r=0n;for(let e=0;e<n.length;e++)r|=BigInt(127&n[e])<<BigInt(7*e);return Number(20===t?r:r<<14n)}function on(e){if(!J(e))throw new Error("Invalid program ID");"string"==typeof e&&(e=parseInt(e));const n=e.toString(2).match(/.{1,7}(?=(.{7})*$)/g).map((e=>String.fromCharCode(parseInt(7===e.length?`1${e}`:e,2)))).reverse().join("");let t=btoa(`js~khan-academyr${5===n.length?"":""}\v\nScratchpad${n}\f`);return t=function(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(t),t}async function cn(e){if(B(e))return e;if(B(`kaid_${e}`))return`kaid_${e}`;if(j(e)){const n=e.match(V);if(!n)throw new Error("Invalid user URL");if(e=n[1],B(e))return e}const n=await Oe(e),t=await n.json();if(an(t),!t.data.user)throw new Error("User not found");const r=t.data.user.kaid;if(!B(r))throw new Error("Invalid KAID");return r}async function dn(e){if(!B(e)&&!Re(e)&&!j(e))return e;if(j(e)){const n=e.match(V);if(!n)throw new Error("Invalid user URL");if(e=n[1],!B(e)&&!Re(e))return e}B(e)||(e=await cn(e));const n=await De(e),t=await n.json();if(an(t),!t.data.user)throw new Error("User not found");return t.data.user.username}function ln(e){if("number"==typeof e){if(!J(e))throw new Error("Invalid program ID");return e}if(X(e)){const n=e.match(z)[1];if(!J(n))throw new Error("Invalid program URL");return parseInt(n,10)}if(se(e)){if(!J(e=sn(e)))throw new Error("Invalid program key");return e}if("string"==typeof e){if(!J(e))throw new Error("Invalid program ID");return parseInt(e,10)}throw new Error("Invalid program identifier")}async function un(e){if(ge(e))return e;if(!be(e))throw new Error("Invalid encrypted message key");const n=await Ke(e),t=await n.json();if(an(t),!t.data.qaExpandKeyInfo)throw new Error("Message key not found");return t.data.qaExpandKeyInfo.unencryptedKey}var pn,yn,hn=(e=>(e.ProcessingJS="pjs",e.HTML="webpage",e.SQL="ace_sql",e.Other="",e))(hn||{}),mn=class e extends Qe{constructor(){super(...arguments),p(this,pn)}get spinoff(){return void 0!==this.origin?!!this.origin:null}get lines(){return this.code?this.code.split("\n").length:null}get url(){return this.rawData?.url?`https://www.khanacademy.org${this.rawData.url}`:this.id?`https://www.khanacademy.org/computer-programming/-/${this.id}`:null}get shortUrl(){return this.id?`https://khanacademy.org/cs/-/${this.id}`:null}get thumbnailUrl(){return this.rawData?.imagePath?`https://www.khanacademy.org${this.rawData.imagePath}`:this.thumbnailID&&this.url?`${this.url}/${this.thumbnailID}.png`:null}static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){const t=ln(n);return new e({id:t,key:"string"==typeof n&&se(n)?n:void 0})}transformSchema(n){return{id:n.id?parseInt(n.id,10):void 0,title:n.translatedTitle,author:n.authorKaid||n.authorNickname||n.creatorProfile?en.fromSchema({kaid:n.authorKaid,nickname:n.authorNickname,isChild:n.byChild??void 0,...n.creatorProfile}):void 0,created:(()=>{if(n.created)return n.revision?.created?new Date(Math.min(new Date(n.created).valueOf(),new Date(n.revision.created).valueOf())):new Date(n.created)})(),updated:(()=>{if(n.revision?.created)return n.created&&n.revision.created===n.created?null:new Date(n.revision.created)})(),width:n.width,height:n.height,votes:n.sumVotesIncremented,spinOffCount:n.spinoffCount??n.displayableSpinoffCount,code:n.revision?.code,hidden:n.hideFromHotlist,type:(()=>{switch(n.revision?.editorType){case"pjs":return e.Type.ProcessingJS;case"webpage":return e.Type.HTML;case"ace_sql":return e.Type.SQL;default:return e.Type.Other}})(),origin:(()=>{if(!n.originScratchpad)return n.originScratchpad;const t=("https://khanacademy.org"+n.originScratchpad.url).match(z)?.[1];if(t)return new e({id:parseInt(t,10),title:n.originScratchpad.translatedTitle,deleted:n.originScratchpad.deleted});console.error(`Failed to parse origin program ID from URL: ${n.originScratchpad.url}`)})(),key:n.key,thumbnailID:n.imagePath&&ee.test(n.imagePath)?parseInt(n.imagePath.match(ee)[1],10):void 0,description:"string"==typeof n.description?""!==n.description?n.description:null:n.description,deleted:n.deleted??void 0,selfFlagged:n.flaggedByUser,selfVoted:n.upVoted}}async get(e=this.client??new zn){if(!this.id&&!this.key)throw new Error("Program is missing ID and key");const n=await e.getProgram(this.id??this.key);return this.copy(n)}async*getTipsAndThanks(e=this.client??new zn,n){for await(const t of e.getProgramTipsAndThanks(h(this,pn,yn).call(this),n))this.tipsAndThanks||this.copy({tipsAndThanks:[]}),t.forEach((e=>this.tipsAndThanks?.push(e))),yield t;return this}async getAllTipsAndThanks(e=this.client??new zn,n){const t=await e.getAllProgramTipsAndThanks(h(this,pn,yn).call(this),n);return this.copy({tipsAndThanks:t})}async*getQuestions(e=this.client??new zn,n){for await(const t of e.getProgramQuestions(h(this,pn,yn).call(this),n))this.questions||this.copy({questions:[]}),t.forEach((e=>this.questions.push(e))),yield t;return this}async getAllQuestions(e=this.client??new zn,n){const t=await e.getAllProgramQuestions(h(this,pn,yn).call(this),n);return this.copy({questions:t})}async*getHelpRequests(e=this.client??new zn,n){for await(const t of e.getProgramHelpRequests(h(this,pn,yn).call(this),n))this.helpRequests||this.copy({helpRequests:[]}),t.forEach((e=>this.helpRequests.push(e))),yield t;return this}async getAllHelpRequests(e=this.client??new zn,n){const t=await e.getAllProgramHelpRequests(h(this,pn,yn).call(this),n);return this.copy({helpRequests:t})}is(e){return this.id&&e.id||this.key&&e.key?this.id&&e.id&&this.id===e.id||this.key&&e.key&&this.key===e.key||!1:(console.warn("Programs don't have any identifiers that can be compared"),!1)}};pn=new WeakSet,yn=function(){if(this.id)return this.id;if(this.key)return this.key;throw new Error("Program has no identifier")},mn.Type=hn;var fn=mn,gn=["blobby_green_style","blobby_yellow_style","blobby_blue_style","blobby_purple_style","area_52_yellow_style","area_52_blue_style","area_52_green_style","area_52_purple_style","eggleston_blue_style","eggleston_yellow_style","eggleston_green_style","eggleston_orange_style","scuttlebug_purple_style","scuttlebug_yellow_style","scuttlebug_blue_style","scuttlebug_green_style","boggle_yellow_style","boggle_blue_style","boggle_green_style","boggle_purple_style","sneak_peak_green_style","sneak_peak_yellow_style","sneak_peak_blue_style","sneak_peak_purple_style","stelly_blue_style","stelly_yellow_style","stelly_green_style","stelly_orange_style","cacteye_purple_style","cacteye_yellow_style","cacteye_blue_style","cacteye_green_style","leaf_green_style","leaf_blue_style","leaf_grey_style","leaf_red_style","leaf_orange_style","leaf_yellow_style","leafers_seed_style","leafers_seedling_style","leafers_sapling_style","leafers_tree_style","leafers_ultimate_style","piceratops_seed_style","piceratops_seedling_style","piceratops_sapling_style","piceratops_tree_style","piceratops_ultimate_style","duskpin_seed_style","duskpin_seedling_style","duskpin_sapling_style","duskpin_tree_style","duskpin_ultimate_style","primosaur_seed_style","primosaur_seedling_style","primosaur_sapling_style","primosaur_tree_style","primosaur_ultimate_style","starky_seed_style","starky_seedling_style","starky_sapling_style","starky_tree_style","starky_ultimate_style","aqualine_seed_style","aqualine_seedling_style","aqualine_sapling_style","aqualine_tree_style","aqualine_ultimate_style","spunky_sam_blue_style","spunky_sam_green_style","spunky_sam_orange_style","spunky_sam_red_style","marcimus_pink_style","marcimus_orange_style","marcimus_red_style","marcimus_purple_style","mr_pink_red_style","mr_pink_green_style","mr_pink_orange_style","female_robot_amelia_style","female_robot_ada_style","female_robot_grace_style","male_robot_johnny_style","male_robot_donald_style","male_robot_hal_style","orange_juice_squid_orange_style","purple_pi_purple_style","purple_pi_pink_style","purple_pi_teal_style","mr_pants_teal_style","mr_pants_green_style","mr_pants_orange_style","mr_pants_pink_style","mr_pants_purple_style","old_spice_man_green_style","old_spice_man_blue_style","winston_default_style","winston_baby_style","ohnoes_default_style","hopper_happy_style","hopper_jumping_style","hopper_cool_style"],_n=["blobby-green","blobby-yellow","blobby-blue","blobby-purple","area-52-yellow","area-52-blue","area-52-green","area-52-purple","eggleston-blue","eggleston-yellow","eggleston-green","eggleston-orange","scuttlebug-purple","scuttlebug-yellow","scuttlebug-blue","scuttlebug-green","boggle-yellow","boggle-blue","boggle-green","boggle-purple","sneak-peak-green","sneak-peak-yellow","sneak-peak-blue","sneak-peak-purple","stelly-blue","stelly-yellow","stelly-green","stelly-orange","cacteye-purple","cacteye-yellow","cacteye-blue","cacteye-green","leaf-green","leaf-blue","leaf-grey","leaf-red","leaf-orange","leaf-yellow","leafers-seed","leafers-seedling","leafers-sapling","leafers-tree","leafers-ultimate","piceratops-seed","piceratops-seedling","piceratops-sapling","piceratops-tree","piceratops-ultimate","duskpin-seed","duskpin-seedling","duskpin-sapling","duskpin-tree","duskpin-ultimate","primosaur-seed","primosaur-seedling","primosaur-sapling","primosaur-tree","primosaur-ultimate","starky-seed","starky-seedling","starky-sapling","starky-tree","starky-ultimate","aqualine-seed","aqualine-seedling","aqualine-sapling","aqualine-tree","aqualine-ultimate","spunky-sam","spunky-sam-green","spunky-sam-orange","spunky-sam-red","marcimus","marcimus-orange","marcimus-red","marcimus-purple","mr-pink","mr-pink-green","mr-pink-orange","robot_female_1","robot_female_2","robot_female_3","robot_male_1","robot_male_2","robot_male_3","orange-juice-squid","purple-pi","purple-pi-pink","purple-pi-teal","mr-pants","mr-pants-green","mr-pants-orange","mr-pants-pink","mr-pants-purple","old-spice-man","old-spice-man-blue","cs-winston","cs-winston-baby","cs-ohnoes","cs-hopper-happy","cs-hopper-jumping","cs-hopper-cool"];function wn(e){return _n[gn.indexOf(e)]}function kn(e){return gn[_n.indexOf(e)]}function bn(e){return`https://www.khanacademy.org/images/avatars/svg/${e}.svg`}function Tn(e){return`https://www.khanacademy.org/images/avatars/${e}.png`}function vn(e){return e.match(/^(?:https:\/\/www\.khanacademy\.org)?\/images\/avatars(?:\/svg)?\/(.*)\.(?:(?:svg)|(?:png))$/)?.[1]??null}function En(e){const n=vn(e);return n?Tn(n):null}function An(e){const n=vn(e);return n?bn(n):null}var Sn,Pn,Cn,In=class extends Qe{get bySelf(){return!!this.client?.user&&this.byUser(this.client.user)}get url(){if(!this.program?.url||!this.encryptedKey)return null;const e={qa_expand_key:this.key??this.encryptedKey,qa_expand_type:this.rawData?.feedbackType?.toLowerCase()},n=new URL(this.program.url);for(const[t,r]of Object.entries(e))r&&n.searchParams.set(t,r);return n.toString()}transformSchema(e){return{text:e.content,author:e.author&&en.fromSchema(e.author),program:(()=>{if("Scratchpad"===e.focus?.kind)return new fn({id:"string"==typeof e.focus.id?parseInt(e.focus.id,10):void 0,title:e.focus.translatedTitle});if(e.focusUrl){const n=e.focusUrl.match(W);if(!n||n.length<1)return;return new fn({id:parseInt(n[1],10)})}})(),created:e.date?new Date(e.date):void 0,key:e.expandKey,encryptedKey:e.key,deleted:e.appearsAsDeleted,locked:e.isLocked,pinned:e.isPinned,verified:e.definitelyNotSpam,score:e.lowQualityScore,byVideoAuthor:e.fromVideoAuthor,selfFlagged:e.flaggedByUser}}byUser(e){return!!this.author&&this.author.is(e)}is(e){return this.key&&e.key||this.encryptedKey&&e.encryptedKey?this.key&&e.key&&this.key===e.key||this.encryptedKey&&e.encryptedKey&&this.encryptedKey===e.encryptedKey||!1:(console.warn("Messages don't have any identifiers that can be compared"),!1)}},Rn=((Sn=Rn||{})[Sn.TipsAndThanks="COMMENT"]="TipsAndThanks",Sn[Sn.Question="QUESTION"]="Question",Sn[Sn.HelpRequest="PROJECT_HELP_QUESTION"]="HelpRequest",Sn),Nn=class e extends In{constructor(){super(...arguments),p(this,Pn)}get selfVoted(){return!1===this.client?.authenticated?null:this.selfUpvoted?1:this.selfDownvoted?-1:0}static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({key:ge(n)?n:void 0,encryptedKey:be(n)?n:void 0})}transformSchema(e){return{...super.transformSchema(e),votes:e.sumVotesIncremented,replyCount:e.replyCount,selfUpvoted:e.upVoted,selfDownvoted:e.downVoted}}copy(e){return super.copy(e)}async get(e=this.client??new zn){const n=await e.getMessage(h(this,Pn,Cn).call(this));return this.copy(n)}async*getReplies(e=this.client??new zn,n){for await(const t of e.getMessageReplies(h(this,Pn,Cn).call(this),n))this.replies||this.copy({replies:[]}),this.replies?.push(...t),yield t;return this}async getAllReplies(e=this.client??new zn){if(!this.key&&!this.encryptedKey)throw new Error("Message does not have a key or encrypted key");const n=await e.getAllMessageReplies(this.key??this.encryptedKey);return this.copy({replies:n})}};Pn=new WeakSet,Cn=function(){if(this.key)return this.key;if(this.encryptedKey)return this.encryptedKey;throw new Error("Message does not have a key or encrypted key")},Nn.Type=Rn;var Un=Nn,On=class e extends Un{static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({key:ge(n)?n:void 0,encryptedKey:be(n)?n:void 0})}transformSchema(e){return{...super.transformSchema(e),question:e.question?Dn.fromSchema(e.question):void 0}}copy(e){return super.copy(e)}},Dn=class e extends Un{static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({key:ge(n)?n:void 0,encryptedKey:be(n)?n:void 0})}transformSchema(e){return{...super.transformSchema(e),answerCount:e.answerCount,old:e.isOld,answers:(()=>{if(!e.answers)return;const n=e.answers.map((e=>On.fromSchema(e)));return n.forEach((e=>e.copy({question:this}))),n})()}}copy(e){return super.copy(e)}},$n=class e extends In{static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({key:ge(n)?n:void 0,encryptedKey:be(n)?n:void 0})}transformSchema(e){return{...super.transformSchema(e),message:(()=>{if(void 0!==e.replyExpandKeys)return"string"==typeof e.replyExpandKeys&&ge(e.replyExpandKeys)?new Un({key:e.replyExpandKeys}):Array.isArray(e.replyExpandKeys)?new Un({key:e.replyExpandKeys[0]}):void 0})()}}copy(e){return super.copy(e)}copyFromSchema(e){return super.copyFromSchema(e)}async get(e=this.client??new zn){if(!this.key&&!this.encryptedKey)throw new Error("Message does not have a key or encrypted key");const n=await e.getMessage(this.key??this.encryptedKey);return this.copy(n)}},Ln=class e extends Un{static fromSchema(n){const t=new e;return t.copyFromSchema(n),t.rawData=n,t}static fromIdentifier(n){return new e({key:ge(n)?n:void 0,encryptedKey:be(n)?n:void 0})}transformSchema(e){return{...super.transformSchema(e),votes:e.sumVotesIncremented,replyCount:e.replyCount,selfUpvoted:e.upVoted,selfDownvoted:e.downVoted}}copy(e){return super.copy(e)}};function xn(e){return"COMMENT"===e.feedbackType}function Kn(e){return"REPLY"===e.feedbackType}function Mn(e){return"QUESTION"===e.feedbackType||"PROJECT_HELP_QUESTION"===e.feedbackType}function qn(e){return"ANSWER"===e.feedbackType}var Fn,Bn,Vn,Qn,jn,Gn,Hn,Wn,Jn={[Rn.TipsAndThanks]:Ln,[Rn.Question]:Dn,[Rn.HelpRequest]:Dn},Yn=class e{constructor(){return p(this,Fn,void 0),p(this,Bn,void 0),p(this,Vn,void 0),p(this,Qn,new Map),p(this,jn,new Map),p(this,Gn,new Map),this.authenticated=!1,this.kaid=null,this}async resolveCachedKaid(e){if(B(e))return e;if(u(this,Qn).has(e))return u(this,Qn).get(e);const n=await cn(e);return u(this,Qn).set(e,n),n}async resolveCachedUsername(e){if(!B(e)&&!Re(e)&&!j(e))return e;if(u(this,jn).has(e))return u(this,jn).get(e);const n=await dn(e);return u(this,jn).set(e,n),n}async resolveCachedFeedbackKey(e){if(ge(e))return e;if(u(this,Gn).has(e))return u(this,Gn).get(e);const n=await un(e);return u(this,Gn).set(e,n),n}get kaas(){return this.authenticated&&u(this,Vn)?u(this,Vn).match(/KAAS=([^;]+)/)?.[1]??null:null}async login(n,t){var r;if(n&&(B(n)&&(n=await this.resolveCachedUsername(n)),y(this,Fn,n)),t&&y(this,Bn,t),!u(this,Fn)||!u(this,Bn)){if(!u(this,Fn))throw new Error("Missing username or email");if(!u(this,Bn))throw new Error("Missing password");throw new Error("Missing username/email and password")}const a=await Fe({identifier:u(this,Fn),password:u(this,Bn)},{credentials:"include"}),s=await h(r=e,Hn,Wn).call(r,a);if(an(s),!s.data.loginWithPassword)throw new Error("Malformed response");if(s.data.loginWithPassword.error)switch(s.data.loginWithPassword.error.code){case Me.ErrorCode.INVALID_CREDENTIALS:throw new Error("Invalid Credentials error: Check your username/email and password");case Me.ErrorCode.TOO_MANY_ATTEMPTS:throw new Error("Too Many Attempts error: Rate-limited by Khan Academy");default:throw new Error("Unknown error code: "+s.data.loginWithPassword.error.code)}const o=a.headers.get("set-cookie");if(!o)throw new Error("No cookies returned: Something went wrong on Khan Academy's end");return y(this,Vn,function(e){return e.replace(/[a-zA-Z]+, \d\d [A-Za-z0-9]+ \d{4} \d\d:\d\d:\d\d [a-zA-Z]+/g,"").replace(/; (Path|Expires|Max-Age|HttpOnly|Secure|SameSite)[^;,]*/g,"").replace(/,/g,";")}(o)),this.authenticated=!0,this.kaid="string"==typeof s.data.loginWithPassword.user?.kaid&&B(s.data.loginWithPassword.user.kaid)?s.data.loginWithPassword.user.kaid:null,null===this.kaid&&console.warn(`User ${n??this.kaas??"unknown"} does not have a valid KAID`),this}async getUser(n){var t;if(!n&&!this.authenticated)throw new Error("Not authenticated: You need to login or provide an indentifier");let r=null;n&&(Re(n)&&(r=n),n=await this.resolveCachedKaid(n));const a=await Ne(n,n?void 0:{credentials:"include",headers:{cookie:u(this,Vn)}}),s=await h(t=e,Hn,Wn).call(t,a);if(an(s),!s.data.user)throw new Error("User not found");const o=en.fromSchema(s.data.user);return o.client=this,!o.email&&r&&Re(r)&&o.copy({email:r}),o.self&&(this.user=o),o.kaid&&(o.username&&!u(this,Qn).has(o.username)&&u(this,Qn).set(o.username,o.kaid),o.email&&!u(this,Qn).has(o.email)&&u(this,Qn).set(o.email,o.kaid)),o}async getUserAvatar(n=this.kaid??u(this,Fn),t="svg"){var r;if(!n)throw new Error("No identifier provided");n=await this.resolveCachedKaid(n);const a=await U(n),s=await h(r=e,Hn,Wn).call(r,a);if(an(s),!s.data.user)throw new Error("User not found");const o=vn(s.data.user.avatar.imageSrc);if(!o)throw new Error("User has no avatar");return"svg"===t?bn(o):Tn(o)}async getUserStatistics(n=this.kaid??u(this,Fn)){var t;if(!n)throw new Error("No identifier provided");n=await this.resolveCachedKaid(n);const r=await Ue(n),a=await h(t=e,Hn,Wn).call(t,r);if(an(a),!a.data.user)throw new Error("User not found");return{votes:a.data.userSummary.statistics.votes,tipsAndThanks:a.data.userSummary.statistics.comments,questions:a.data.userSummary.statistics.questions,answers:a.data.userSummary.statistics.answers,helpRequests:a.data.userSummary.statistics.projectquestions,helpRequestAnswers:a.data.userSummary.statistics.projectanswers,replies:a.data.userSummary.statistics.replies,flags:a.data.userSummary.statistics.flags}}async*getUserPrograms(n,t="TOP",r=40){if(!n&&!this.authenticated)throw new Error("Not authenticated: You need to login or provide an indentifier");if(n??(n=this.kaid??this.user?.username??this.user?.email),!n)throw new Error("Missing identifier for logged in user");const a={kaid:await this.resolveCachedKaid(n),pageInfo:{cursor:null,itemsPerPage:r},sort:t},s=async n=>{var t;const r=await xe({...a,pageInfo:{...a.pageInfo,cursor:n}}),s=await h(t=e,Hn,Wn).call(t,r);if(an(s),!s.data.user)throw new Error("User not found");if(!s.data.user.programs.complete&&!s.data.user.programs.cursor)throw new Error("Cursor not found");return{programs:s.data.user.programs.programs.map((e=>{const n=fn.fromSchema(e);return n.client=this,n})),cursor:s.data.user.programs.complete?null:s.data.user.programs.cursor}};let{programs:o,cursor:i}=await s();for(yield o;i;)({programs:o,cursor:i}=await s(i)),yield o}async getAllUserPrograms(e,n="TOP",t=100){const r=[];for await(const a of this.getUserPrograms(e,n,t))r.push(...a);return r}async getProgram(n){var t;n=ln(n);const r=await Le(n),a=await h(t=e,Hn,Wn).call(t,r);if(an(a),!a.data.programById)throw new Error("Program not found");const s=fn.fromSchema(a.data.programById);return s.client=this,this.user&&s.author?.kaid===this.kaid&&(s.copy({author:this.user}),console.debug(`Copied the client's user data to program ${s.title?`"${function(e,n,t="..."){return n=Math.max(0,n),e.length>n?e.slice(0,n-t.length)+t:e}(s.title,32)}"`:s.id??"unknown"} because the program's author matches the client user`)),s}async*getHotlistPrograms(n="HOT",t=40,r=!1){const a={onlyOfficialProjectSpinoffs:r,sort:n,pageInfo:{cursor:null,itemsPerPage:t}},s=async n=>{var t;const r=await $e({...a,pageInfo:{...a.pageInfo,cursor:n}}),s=await h(t=e,Hn,Wn).call(t,r);if(an(s),!s.data.listTopPrograms)throw new Error("Programs not found");if(!s.data.listTopPrograms.complete&&!s.data.listTopPrograms.cursor)throw new Error("Cursor not found");return{programs:s.data.listTopPrograms.programs.map((e=>{const n=fn.fromSchema(e);return n.client=this,n})),cursor:s.data.listTopPrograms.complete?null:s.data.listTopPrograms.cursor}};let{programs:o,cursor:i}=await s();for(yield o;i;)({programs:o,cursor:i}=await s(i)),yield o}async*getTopPrograms(e=40,n=!1){yield*this.getHotlistPrograms("TOP",e,n)}async*getRecentPrograms(e=40,n=!1){yield*this.getHotlistPrograms("RECENT",e,n)}async getMessage(n){var t;ge(n)||(n=await this.resolveCachedFeedbackKey(n));const r=await O({topicId:4669512406581248..toString(),focusKind:"Scratchpad",feedbackType:"COMMENT",currentSort:1,qaExpandKey:n}),a=await h(t=e,Hn,Wn).call(t,r);if(an(a),!a.data.feedback||!a.data.feedback.feedback||0===a.data.feedback.feedback.length)throw new Error("Message not found");const s=a.data.feedback.feedback[0];let o;if(xn(s))o=Ln.fromSchema(s);else{if(!Mn(s))throw new Error("Unknown message type");{const e=Dn.fromSchema(s);if(e.key!==n){const t=e.answers?.find((e=>e.key===n));if(!t)throw new Error("Question or answer not found");o=t,o.copy({question:e})}else o=e}}return o.client=this,this.user&&o.author?.kaid===this.kaid&&(o.copy({author:this.user}),console.debug(`Copied the client's user data to comment ${o.key??o.encryptedKey??"unknown"} because the comment's author matches the client user`)),o}async getTipsAndThanks(e){return this.getMessage(e)}async getQuestion(e){return this.getMessage(e)}async getAnswer(e){return this.getMessage(e)}async getReply(n){var t;const r=await this.getMessage(n);if(!r.key)throw new Error("Message has no key");const a=await D(r.key),s=await h(t=e,Hn,Wn).call(t,a);if(an(s),!s.data.feedbackReplies||0===s.data.feedbackReplies.length)throw new Error("Reply not found");const o=s.data.feedbackReplies.find((e=>e.expandKey===n||e.key===n));if(!o)throw new Error("Reply not found");const i=$n.fromSchema(o);return i.client=this,i.copy({message:r}),this.user&&i.author?.kaid===this.kaid&&(i.copy({author:this.user}),console.debug(`Copied the client's user data to reply ${i.key??i.encryptedKey??"unknown"} because the reply's author matches the client user`)),i}async*getProgramMessages(n=Un.Type.TipsAndThanks,t,r=1){const a={topicId:(t=ln(t)).toString(),focusKind:"Scratchpad",feedbackType:n,currentSort:r},s=async t=>{var r;const s=await O({...a,cursor:t}),o=await h(r=e,Hn,Wn).call(r,s);if(an(o),!o.data.feedback.feedback)throw new Error("Comments not found");if(!o.data.feedback.isComplete&&!o.data.feedback.cursor)throw new Error("Cursor not found");return{messages:o.data.feedback.feedback.map((e=>{const t=Jn[n].fromSchema(e);return t.client=this,t})),cursor:!o.data.feedback.isComplete&&o.data.feedback.cursor}};let{messages:o,cursor:i}=await s();for(yield o;i;)({messages:o,cursor:i}=await s(i)),yield o}async getAllProgramMessages(e=Un.Type.TipsAndThanks,n,t=1){const r=[];for await(const a of this.getProgramMessages(e,n,t))r.push(...a);return r}async*getProgramTipsAndThanks(e,n=1){yield*this.getProgramMessages(Un.Type.TipsAndThanks,e,n)}async getAllProgramTipsAndThanks(e,n=1){return this.getAllProgramMessages(Un.Type.TipsAndThanks,e,n)}async*getProgramQuestions(e,n=1){yield*this.getProgramMessages(Un.Type.Question,e,n)}async getAllProgramQuestions(e,n=1){return this.getAllProgramMessages(Un.Type.Question,e,n)}async*getProgramHelpRequests(e,n=1){yield*this.getProgramMessages(Un.Type.HelpRequest,e,n)}async getAllProgramHelpRequests(e,n=1){return this.getAllProgramMessages(Un.Type.HelpRequest,e,n)}async*getMessageReplies(n,t=10){const r={postKey:n,cursor:null,limit:t},a=async n=>{var t;const a=await $({...r,cursor:n}),s=await h(t=e,Hn,Wn).call(t,a);if(an(s),!s.data.feedbackRepliesPaginated)throw new Error("Replies not found");if(!s.data.feedbackRepliesPaginated.isComplete&&!s.data.feedbackRepliesPaginated.cursor)throw new Error("Cursor not found");const o=s.data.feedbackRepliesPaginated.feedback;return o?{replies:o.map((e=>{const n=$n.fromSchema(e);return n.client=this,n})),cursor:s.data.feedbackRepliesPaginated.isComplete?null:s.data.feedbackRepliesPaginated.cursor}:{replies:[],cursor:null}};let{replies:s,cursor:o}=await a();for(yield s;o;)({replies:s,cursor:o}=await a(o)),yield s}async getAllMessageReplies(n){var t;const r=await D(n),a=await h(t=e,Hn,Wn).call(t,r);if(an(a),!a.data.feedbackReplies)throw new Error("Replies not found");return a.data.feedbackReplies.map((e=>{const n=$n.fromSchema(e);return n.client=this,n}))}};Fn=new WeakMap,Bn=new WeakMap,Vn=new WeakMap,Qn=new WeakMap,jn=new WeakMap,Gn=new WeakMap,Hn=new WeakSet,Wn=async function(e){try{return await e.json()}catch(e){const n=e instanceof Error?e.message:"string"==typeof e?e:"Unknown error";throw new Error(`Failed to parse response JSON: ${n}`)}},p(Yn,Hn);var zn=Yn;(e=>{d(r({},"__esModule",{value:!0}),e)})(f)})()},593:e=>{e.exports=JSON.parse('{"AddFeedbackToDiscussion":"mutation AddFeedbackToDiscussion($focusKind: String, $focusId: String, $parentKey: String, $textContent: String!, $feedbackType: FeedbackType!, $fromVideoAuthor: Boolean, $shownLowQualityNotice: Boolean) {\\n  addFeedbackToDiscussion(focusKind: $focusKind, focusId: $focusId, parentKey: $parentKey, textContent: $textContent, feedbackType: $feedbackType, fromVideoAuthor: $fromVideoAuthor, shownLowQualityNotice: $shownLowQualityNotice) {\\n    feedback {\\n      appearsAsDeleted\\n      author {\\n        id\\n        kaid\\n        nickname\\n        avatar {\\n          name\\n          imageSrc\\n          __typename\\n        }\\n        __typename\\n      }\\n      content\\n      date\\n      definitelyNotSpam\\n      deleted\\n      downVoted\\n      expandKey\\n      feedbackType\\n      flaggedBy\\n      flags\\n      focusUrl\\n      focus {\\n        kind\\n        id\\n        translatedTitle\\n        relativeUrl\\n        __typename\\n      }\\n      fromVideoAuthor\\n      key\\n      notifyOnAnswer\\n      permalink\\n      qualityKind\\n      replyCount\\n      replyExpandKeys\\n      sumVotesIncremented\\n      upVoted\\n      __typename\\n    }\\n    lowQualityResponse {\\n      feedbackCode\\n      feedbackChar\\n      feedbackType\\n      showLowQualityNotice\\n      __typename\\n    }\\n    error {\\n      code\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n","clearBrandNewNotifications":"mutation clearBrandNewNotifications {\\n  clearBrandNewNotifications {\\n    error {\\n      code\\n      __typename\\n    }\\n    __typename\\n  }\\n}","feedbackQuery":"query feedbackQuery($topicId: String!, $focusKind: String!, $cursor: String, $limit: Int, $feedbackType: FeedbackType!, $currentSort: Int, $qaExpandKey: String) {\\n  feedback(focusId: $topicId, cursor: $cursor, limit: $limit, feedbackType: $feedbackType, focusKind: $focusKind, sort: $currentSort, qaExpandKey: $qaExpandKey, answersLimit: 1) {\\n    feedback {\\n      isLocked\\n      isPinned\\n      replyCount\\n      appearsAsDeleted\\n      author {\\n        id\\n        kaid\\n        nickname\\n        avatar {\\n          name\\n          imageSrc\\n          __typename\\n        }\\n        __typename\\n      }\\n      badges {\\n        name\\n        icons {\\n          smallUrl\\n          __typename\\n        }\\n        description\\n        __typename\\n      }\\n      content\\n      date\\n      definitelyNotSpam\\n      deleted\\n      downVoted\\n      expandKey\\n      feedbackType\\n      flaggedBy\\n      flaggedByUser\\n      flags\\n      focusUrl\\n      focus {\\n        kind\\n        id\\n        translatedTitle\\n        relativeUrl\\n        __typename\\n      }\\n      fromVideoAuthor\\n      key\\n      lowQualityScore\\n      notifyOnAnswer\\n      permalink\\n      qualityKind\\n      replyCount\\n      replyExpandKeys\\n      showLowQualityNotice\\n      sumVotesIncremented\\n      upVoted\\n      ... on QuestionFeedback {\\n        hasAnswered\\n        answers {\\n          isLocked\\n          isPinned\\n          replyCount\\n          appearsAsDeleted\\n          author {\\n            id\\n            kaid\\n            nickname\\n            avatar {\\n              name\\n              imageSrc\\n              __typename\\n            }\\n            __typename\\n          }\\n          badges {\\n            name\\n            icons {\\n              smallUrl\\n              __typename\\n            }\\n            description\\n            __typename\\n          }\\n          content\\n          date\\n          definitelyNotSpam\\n          deleted\\n          downVoted\\n          expandKey\\n          feedbackType\\n          flaggedBy\\n          flaggedByUser\\n          flags\\n          focusUrl\\n          focus {\\n            kind\\n            id\\n            translatedTitle\\n            relativeUrl\\n            __typename\\n          }\\n          fromVideoAuthor\\n          key\\n          lowQualityScore\\n          notifyOnAnswer\\n          permalink\\n          qualityKind\\n          replyCount\\n          replyExpandKeys\\n          showLowQualityNotice\\n          sumVotesIncremented\\n          upVoted\\n          __typename\\n        }\\n        isOld\\n        answerCount\\n        __typename\\n      }\\n      ... on AnswerFeedback {\\n        question {\\n          isLocked\\n          isPinned\\n          replyCount\\n          appearsAsDeleted\\n          author {\\n            id\\n            kaid\\n            nickname\\n            avatar {\\n              name\\n              imageSrc\\n              __typename\\n            }\\n            __typename\\n          }\\n          badges {\\n            name\\n            icons {\\n              smallUrl\\n              __typename\\n            }\\n            description\\n            __typename\\n          }\\n          content\\n          date\\n          definitelyNotSpam\\n          deleted\\n          downVoted\\n          expandKey\\n          feedbackType\\n          flaggedBy\\n          flaggedByUser\\n          flags\\n          focusUrl\\n          focus {\\n            kind\\n            id\\n            translatedTitle\\n            relativeUrl\\n            __typename\\n          }\\n          fromVideoAuthor\\n          key\\n          lowQualityScore\\n          notifyOnAnswer\\n          permalink\\n          qualityKind\\n          replyCount\\n          replyExpandKeys\\n          showLowQualityNotice\\n          sumVotesIncremented\\n          upVoted\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    cursor\\n    isComplete\\n    sortedByDate\\n    __typename\\n  }\\n}\\n","getFeedbackRepliesPage":"query getFeedbackRepliesPage($postKey: String!, $cursor: String, $limit: Int!) {\\n  feedbackRepliesPaginated(feedbackKey: $postKey, cursor: $cursor, limit: $limit) {\\n    cursor\\n    isComplete\\n    feedback {\\n      isLocked\\n      isPinned\\n      expandKey\\n      appearsAsDeleted\\n      author {\\n        id\\n        kaid\\n        nickname\\n        avatar {\\n          name\\n          imageSrc\\n          __typename\\n        }\\n        __typename\\n      }\\n      content\\n      date\\n      definitelyNotSpam\\n      deleted\\n      downVoted\\n      expandKey\\n      feedbackType\\n      flaggedBy\\n      flaggedByUser\\n      flags\\n      focusUrl\\n      fromVideoAuthor\\n      key\\n      lowQualityScore\\n      notifyOnAnswer\\n      permalink\\n      qualityKind\\n      replyCount\\n      replyExpandKeys\\n      showLowQualityNotice\\n      sumVotesIncremented\\n      upVoted\\n      __typename\\n    }\\n    __typename\\n  }\\n}","getFullUserProfile":"query getFullUserProfile($kaid: String, $username: String) {\\n  user(kaid: $kaid, username: $username) {\\n    id\\n    kaid\\n    key\\n    userId\\n    email\\n    username\\n    profileRoot\\n    gaUserId\\n    isPhantom\\n    isDeveloper: hasPermission(name: \\"can_do_what_only_admins_can_do\\")\\n    isCurator: hasPermission(name: \\"can_curate_tags\\", scope: ANY_ON_CURRENT_LOCALE)\\n    isCreator: hasPermission(name: \\"has_creator_role\\", scope: ANY_ON_CURRENT_LOCALE)\\n    isPublisher: hasPermission(name: \\"can_publish\\", scope: ANY_ON_CURRENT_LOCALE)\\n    isModerator: hasPermission(name: \\"can_moderate_users\\", scope: GLOBAL)\\n    isParent\\n    isTeacher\\n    isFormalTeacher\\n    isDataCollectible\\n    isChild\\n    isOrphan\\n    isCoachingLoggedInUser\\n    canModifyCoaches\\n    nickname\\n    hideVisual\\n    joined\\n    points\\n    countVideosCompleted\\n    bio\\n    profile {\\n      accessLevel\\n      __typename\\n    }\\n    soundOn\\n    muteVideos\\n    showCaptions\\n    prefersReducedMotion\\n    noColorInVideos\\n    newNotificationCount\\n    canHellban: hasPermission(name: \\"can_ban_users\\", scope: GLOBAL)\\n    canMessageUsers: hasPermission(\\n      name: \\"can_send_moderator_messages\\"\\n      scope: GLOBAL\\n    )\\n    isSelf: isActor\\n    hasStudents: hasCoachees\\n    hasClasses\\n    hasChildren\\n    hasCoach\\n    badgeCounts\\n    homepageUrl\\n    isMidsignupPhantom\\n    includesDistrictOwnedData\\n    includesKmapDistrictOwnedData\\n    includesK4dDistrictOwnedData\\n    canAccessDistrictsHomepage\\n    preferredKaLocale {\\n      id\\n      kaLocale\\n      status\\n      __typename\\n    }\\n    underAgeGate {\\n      parentEmail\\n      daysUntilCutoff\\n      approvalGivenAt\\n      __typename\\n    }\\n    authEmails\\n    signupDataIfUnverified {\\n      email\\n      emailBounced\\n      __typename\\n    }\\n    pendingEmailVerifications {\\n      email\\n      __typename\\n    }\\n    hasAccessToAIGuideTeacher\\n    tosAccepted\\n    shouldShowAgeCheck\\n    birthMonthYear\\n    lastLoginCountry\\n    __typename\\n  }\\n  actorIsImpersonatingUser\\n  isAIGuideEnabled\\n  hasAccessToAIGuideDev\\n}","getNotificationsForUser":"uery getNotificationsForUser($after: ID) {\\n  user {\\n    id\\n    notifications(after: $after) {\\n      notifications {\\n        __typename\\n        brandNew\\n        class_\\n        date\\n        kaid\\n        read\\n        url\\n        urlsafeKey\\n        ...ThreadCreatedNotificationType\\n        ...AssignmentDueDateNotificationType\\n        ...AssignmentCreatedNotificationType\\n        ...CoachRequestNotificationType\\n        ...BadgeNotificationType\\n        ...CourseMasteryGoalCreatedNotificationType\\n        ...ModeratorNotificationType\\n        ...ProgramFeedbackNotificationType\\n        ...CoachRequestAcceptedNotificationType\\n        ...AvatarNotificationType\\n        ...InfoNotificationType\\n        ...ResponseFeedbackNotificationType\\n        ...GroupedBadgeNotificationType\\n        ...UnitMasteryGoalCreatedNotificationType\\n        ...UnitMasteryDueDateCreatedNotificationType\\n        ...CourseMasteryDueDateCreatedNotificationType\\n        ...MasteryGoalDueDateApproachingCreatedNotificationType\\n      }\\n      pageInfo {\\n        nextCursor\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment AssignmentCreatedNotificationType on AssignmentCreatedNotification {\\n  numAssignments\\n  contentTitle\\n  curationNodeIconURL\\n  className\\n  __typename\\n}\\n\\nfragment AssignmentDueDateNotificationType on AssignmentDueDateNotification {\\n  numAssignments\\n  dueDate\\n  contentTitle\\n  curationNodeIconURL\\n  __typename\\n}\\n\\nfragment AvatarNotificationType on AvatarNotification {\\n  name\\n  thumbnailSrc\\n  __typename\\n}\\n\\nfragment BadgeNotificationType on BadgeNotification {\\n  badgeName\\n  badge {\\n    description\\n    fullDescription\\n    name\\n    relativeUrl\\n    icons {\\n      compactUrl\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CoachRequestAcceptedNotificationType on CoachRequestAcceptedNotification {\\n  isMultipleClassrooms\\n  student {\\n    id\\n    email\\n    nickname\\n    __typename\\n  }\\n  classroom {\\n    cacheId\\n    id\\n    name\\n    topics {\\n      id\\n      slug\\n      iconUrl\\n      key\\n      translatedStandaloneTitle\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CoachRequestNotificationType on CoachRequestNotification {\\n  coachIsParent\\n  coach {\\n    id\\n    kaid\\n    nickname\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CourseMasteryDueDateCreatedNotificationType on CourseMasteryDueDateCreatedNotification {\\n  dueDate\\n  course {\\n    id\\n    iconUrl\\n    translatedStandaloneTitle\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CourseMasteryGoalCreatedNotificationType on CourseMasteryGoalCreatedNotification {\\n  curationNodeIconURL\\n  curationNodeTranslatedTitle\\n  masteryPercentage\\n  __typename\\n}\\n\\nfragment GroupedBadgeNotificationType on GroupedBadgeNotification {\\n  badgeNotifications {\\n    badge {\\n      badgeCategory\\n      description\\n      fullDescription\\n      name\\n      icons {\\n        compactUrl\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment InfoNotificationType on InfoNotification {\\n  notificationType\\n  __typename\\n}\\n\\nfragment MasteryGoalDueDateApproachingCreatedNotificationType on MasteryGoalDueDateApproachingCreatedNotification {\\n  classroomInfo: classroom {\\n    id\\n    cacheId\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment ModeratorNotificationType on ModeratorNotification {\\n  text\\n  __typename\\n}\\n\\nfragment ProgramFeedbackNotificationType on ProgramFeedbackNotification {\\n  authorAvatarSrc\\n  authorNickname\\n  feedbackType\\n  translatedScratchpadTitle\\n  content\\n  __typename\\n}\\n\\nfragment ResponseFeedbackNotificationType on ResponseFeedbackNotification {\\n  authorAvatarUrl\\n  authorNickname\\n  feedbackType\\n  focusTranslatedTitle\\n  content\\n  sumVotesIncremented\\n  __typename\\n}\\n\\nfragment ThreadCreatedNotificationType on ThreadCreatedNotification {\\n  coachee {\\n    id\\n    kaid\\n    nickname\\n    __typename\\n  }\\n  threadId\\n  flagged\\n  __typename\\n}\\n\\nfragment UnitMasteryDueDateCreatedNotificationType on UnitMasteryDueDateCreatedNotification {\\n  dueDate\\n  unit {\\n    id\\n    iconUrl\\n    translatedStandaloneTitle\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment UnitMasteryGoalCreatedNotificationType on UnitMasteryGoalCreatedNotification {\\n  numAssignmentsCount: numAssignments\\n  classroomInfo: classroom {\\n    cacheId\\n    id\\n    coach {\\n      id\\n      nickname\\n      __typename\\n    }\\n    __typename\\n  }\\n  unit {\\n    id\\n    iconUrl\\n    parent {\\n      id\\n      iconUrl\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}"}')}},n={};function t(r){var a=n[r];if(void 0!==a)return a.exports;var s=n[r]={exports:{}};return e[r].call(s.exports,s,s.exports,t),s.exports}t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=t(626),n=t(921),r="khanAcademyNotifications";async function a(){const t=performance.now();let r;try{r=await(0,n.getUserFkeyCookie)()}catch(e){return chrome.action.setBadgeText({text:""}),void chrome.storage.local.set({cached_data:"info:logout",cached_cursor:""})}const a=await(0,e.getNotificationCount)(r);if(!a)return;if(0===a.value&&chrome.action.setBadgeText({text:""}),"!user"===a.error)return void console.log("No user found: ",a.value);const s=await(0,e.getNotificationData)(r);s&&("nonotifications"===s.error&&(chrome.action.setBadgeText({text:""}),chrome.storage.local.remove("prefetchCursor"),chrome.storage.local.set({prefetchData:"info:nonotifications"})),void 0===s.error&&(console.log(`Notifications (${(performance.now()-t).toFixed(3)}ms): `,s.value?.notifications),chrome.storage.local.set({prefetchData:s.value?.notifications,prefetchCursor:s.value?.cursor}),0!==a.value&&chrome.action.setBadgeText({text:a.value>98?"99+":a.value?.toString()})))}chrome.runtime.onInstalled.addListener(e.createOffscreenHeartbeat),chrome.runtime.onMessage.addListener((e=>{e.keepAlive})),chrome.cookies.onChanged.addListener((async({cookie:{name:e},removed:n})=>{"KAAS"===e&&(chrome.action.setBadgeText({text:""}),n?(console.log("Logged out!"),chrome.storage.local.remove(["prefetchCursor"]),chrome.storage.local.set({prefetchData:"info:logout"})):(console.log("Logged in!"),chrome.storage.local.remove(["prefetchCursor","prefetchData"]),a()))})),chrome.alarms.onAlarm.addListener((async({name:e})=>{e===r&&a()})),chrome.storage.local.remove(["prefetchCursor","prefetchData","commentSort"]),chrome.action.setBadgeBackgroundColor({color:"#00BFA5"}),chrome.alarms.clear(r),chrome.alarms.create(r,{periodInMinutes:1}),a()})()})();